{% extends 'base.html' %}

{% block title %}My Listings - The Helping Hand{% endblock %}

{% block content %}
<div class="container">
    <div class="section-title">
        <h2>ğŸ“‹ My Listings</h2>
        <p>Manage your listings and view feedback</p>
    </div>

    {% if listings %}
        <div class="cards-grid">
            {% for listing in listings %}
                <div class="card">
                    <div class="card-header">
                        <span class="category">{{ listing.category }}</span>
                        <span class="type">{{ listing.listing_type }}</span>
                    </div>
                    <div class="card-body">
                        <h3>{{ listing.title }}</h3>
                        <p>{{ listing.description[:100] }}{% if listing.description|length > 100 %}...{% endif %}</p>
                        
                        <!-- Stats Row -->
                        <div style="display: flex; gap: 1rem; margin: 0.75rem 0; flex-wrap: wrap;">
                            <!-- Interest Count -->
                            {% if listing.interest_count > 0 %}
                                <span style="background: #fff3e0; color: #e65100; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    ğŸ’¡ {{ listing.interest_count }} interested
                                </span>
                            {% endif %}
                            
                            <!-- Rating Display -->
                            {% if listing.average_rating %}
                                <span style="background: #e8f5e9; color: #2e7d32; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.85rem;">
                                    â­ {{ listing.average_rating }}/5 ({{ listing.feedbacks|length }})
                                </span>
                            {% endif %}
                        </div>

                        <!-- Edit Lock Status -->
                        {% if listing.has_feedback %}
                            <div class="edit-locked" style="background: #fff3e0; padding: 0.5rem; border-radius: 6px; margin: 0.5rem 0; font-size: 0.85rem;">
                                ğŸ”’ Editing locked (has feedback)
                            </div>
                        {% else %}
                            <div class="edit-unlocked" style="background: #e8f5e9; padding: 0.5rem; border-radius: 6px; margin: 0.5rem 0; font-size: 0.85rem;">
                                âœï¸ Can be edited
                            </div>
                        {% endif %}

                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem; flex-wrap: wrap;">
                            <a href="{{ url_for('listing_detail', id=listing.id) }}" class="btn btn-primary" style="font-size: 0.9rem;">View</a>
                            {% if listing.can_edit %}
                                <a href="{{ url_for('edit_listing', id=listing.id) }}" class="btn btn-secondary" style="font-size: 0.9rem;">Edit</a>
                            {% endif %}
                            <a href="{{ url_for('view_interests', id=listing.id) }}" class="btn btn-secondary" style="font-size: 0.9rem;">
                                ğŸ’¡ Interests ({{ listing.interest_count }})
                            </a>
                            <a href="{{ url_for('delete_listing', id=listing.id) }}" class="btn btn-danger" style="font-size: 0.9rem;" onclick="return confirm('Are you sure you want to delete this listing?');">Delete</a>
                        </div>
                    </div>
                    <div class="card-footer">
                        <span class="author">Created {{ listing.created_at.strftime('%b %d, %Y') }}</span>
                        {% if listing.location %}
                            <span class="location">ğŸ“ {{ listing.location }}</span>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div style="text-align: center; padding: 3rem;">
            <p style="color: var(--text-secondary); margin-bottom: 1rem;">You don't have any listings yet.</p>
            <a href="{{ url_for('create_listing') }}" class="btn btn-primary">Create Your First Listing</a>
        </div>
    {% endif %}
</div>
{% endblock %}